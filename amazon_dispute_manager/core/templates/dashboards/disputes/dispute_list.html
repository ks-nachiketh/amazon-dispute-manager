<!-- Extend base template for consistent layout -->
{% extends "base.html" %}
<!-- Load static files template tag for CSS/JS resources -->
{% load static %}

<!-- Main content block override -->
{% block content %}
<div class="container-amazon">
  <!-- Page header with Amazon styling -->
  <div class="row mb-4">
    <div class="col">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-exclamation-triangle me-2" style="color: var(--amazon-orange); font-size: 1.5rem;"></i>
        <h1 class="h2 mb-0" style="color: var(--amazon-blue); font-weight: 400;">Dispute Cases</h1>
      </div>
      <p class="text-muted">Resolve customer disputes and A-to-Z claims effectively</p>
    </div>
  </div>

  <!-- Action buttons with Amazon styling -->
  <div class="row mb-4">
    <div class="col">
      <!-- Navigation button to return to homepage -->
      <a href="{% url 'core:homepage' %}" class="btn btn-amazon-secondary me-2">
        <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
      </a>

      <!-- Create new dispute button with HTMX functionality -->
      <button id="create-dispute-btn" class="btn btn-amazon-primary me-2" type="button"
        hx-get="{% url 'core:dispute_create_modal' %}"
        hx-target="#modal-body"
        hx-swap="innerHTML"
        data-bs-toggle="modal"
        data-bs-target="#modal"
        hx-on="htmx:afterSwap: if (event.detail.target && event.detail.target.id === 'modal-body') { showModal(); }">
        <i class="fas fa-plus me-1"></i>Create Dispute
      </button>

      <!-- Delete selected disputes button with JavaScript onclick handler -->
      <button id="delete-dispute-btn" class="btn btn-outline-danger" type="button"
        onclick="deleteSelectedDisputes()">
        <i class="fas fa-trash me-1"></i>Delete Selected
      </button>
    </div>
  </div>

<!-- Disputes data table with Bootstrap striped styling -->
<table class="table table-striped">
  <!-- Table header with column definitions -->
  <thead>
    <tr>
      <!-- Master checkbox for selecting all disputes -->
      <th><input type="checkbox" id="select-all" onclick="toggleSelectAll(this)"></th>
      <!-- Column headers for dispute data -->
      <th>Case ID</th>
      <th>Title</th>
      <th>Status</th>
      <th>Order</th>
      <th>Returns</th>
      <th>Created</th>
    </tr>
  </thead>
  
  <!-- Table body with HTMX out-of-band swap for dynamic updates -->
  <tbody id="disputes-table-body" hx-swap-oob="true">
    <!-- Loop through disputes from Django context -->
    {% for dispute in disputes %}
      <!-- Include dispute row partial template for each dispute -->
      {% include "dashboards/disputes/partials/dispute_row.html" %}
    {% empty %}
      <!-- Display message when no disputes exist -->
      <tr><td colspan="7">No disputes yet.</td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- Bootstrap modal for dispute creation/editing -->
<div class="modal fade" id="modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal header with title and close button -->
      <div class="modal-header">
        <h5 class="modal-title">Create Dispute</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <!-- Modal body where HTMX content will be dynamically loaded -->
      <div class="modal-body" id="modal-body">
        <!-- Content loaded by HTMX -->
      </div>
    </div>
  </div>
</div>

{% endblock %}

<!-- Custom scripts block -->
{% block scripts %}
<script>
  // Set up URLs for JavaScript functionality
  window.disputeDeleteUrl = "{% url 'core:dispute_delete' %}";
</script>
<!-- Load dispute list specific JavaScript functionality -->
<script src="{% static 'js/dashboards/disputes/dispute_list.js' %}"></script>
{% endblock %}